name: CI
on:
  pull_request:
    branches:
    - main
  push:
    branches:
    - main
  workflow_dispatch: {}
env:
  GITHUB_TOKEN: ${{ github.token }}

jobs:
  job-a:
    name: Small test job to print something slowly to 60 seconds
    runs-on: ubuntu-20.04
    steps:
    - uses: actions/checkout@v3
    - run: for ((i=1; i<=5; i++)); do echo "$(date)"; sleep 1; done
    - run: |
        job_id="$(gh run view ${{ github.run_id }} --json jobs --jq '.jobs[] | select(.name == "Small test job to print something slowly to 60 seconds") | .databaseId')"
        echo "Workflow ID: ${{ github.run_id }}"
        echo "Job ID: $job_id"
        gh api -XGET /repos/:owner/:repo/actions/jobs/${job_id}/logs

  job-b:
    runs-on: ubuntu-22.04
    needs: [job-a]
    steps:
    - uses: actions/checkout@v3
    - run: |
        job_id="$(gh run view ${{ github.run_id }} --json jobs --jq '.jobs[] | select(.name == "Small test job to print something slowly to 60 seconds") | .databaseId')"
        echo "Workflow ID: ${{ github.run_id }}"
        echo "Job ID: $job_id"
        gh api -XGET /repos/:owner/:repo/actions/jobs/${job_id}/logs
        # curl -L -XGET -H "Authorization: Bearer ${{ github.token }}" https://api.github.com/repos/wheelerlaw/test-workflow/actions/jobs/${job_id}/logs
        


